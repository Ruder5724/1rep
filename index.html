<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∫–æ–ª—å–Ω–∞—è –±–∞–∑–∞ —Ä–∞–±–æ—Ç TAG - –ü–æ–∏—Å–∫</title>
    <style>
        /* ... –≤—Å–µ —Ç–≤–æ–∏ —Å—Ç–∏–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */

        .work-download {
            display: inline-block;
            background-color: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
            margin-top: 10px;
        }

        .work-download:hover {
            background-color: #c0392b;
        }

        .pdf-label {
            font-size: 14px;
            color: #777;
            margin-top: 5px;
        }

        /* ... –æ—Å—Ç–∞–ª—å–Ω–æ–π CSS –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
    </style>
</head>
<body>
    <div class="header">
        <h1>–®–∫–æ–ª—å–Ω–∞—è –±–∞–∑–∞ —É—á–µ–±–Ω—ã—Ö —Ä–∞–±–æ—Ç TAG</h1>
    </div>

    <div class="search-container">
        <!-- ... –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã ... -->
    </div>

    <div id="searchResults" class="search-results" style="display: none;"></div>

    <div id="workPage" class="work-page">
        <h2 class="work-title" id="workTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã</h2>
        <div class="work-meta">
            <span>–ê–≤—Ç–æ—Ä: <span id="workAuthor"></span></span>
            <span>–¢–∏–ø: <span id="workType"></span></span>
            <span>–ö–ª–∞—Å—Å: <span id="workGradeLevel"></span></span>
            <span>–ì–æ–¥: <span id="workYear"></span></span>
            <span class="work-grade">–ë–∞–ª–ª—ã: <span id="workGrade"></span></span>
            <span class="work-supervisor">–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å: <span id="workSupervisor"></span></span>
        </div>

        <div class="work-preview" id="workPreview" style="display: none;">
            <iframe id="workFrame" src="" allowfullscreen></iframe>
        </div>

        <div class="work-content" id="workContent">
            –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...
        </div>

        <!-- ‚úÖ –ö–Ω–æ–ø–∫–∞ PDF -->
        <a href="#" class="work-download" id="workDownload" target="_blank">üìÑ –û—Ç–∫—Ä—ã—Ç—å PDF</a>
        <div class="pdf-label">PDF —Ñ–∞–π–ª</div>

        <span class="view-toggle" id="viewToggle">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–Ω–ª–∞–π–Ω</span>
        <br>
        <a href="#" class="back-to-search" id="backToSearch">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–∏—Å–∫—É</a>
    </div>

    <div class="footer">
        ¬© 2025 Tartu Annelinna Gumnaasium
    </div>

    <script>
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const searchInput = document.getElementById('searchQuery');
        const searchButton = document.getElementById('searchButton');
        const searchResults = document.getElementById('searchResults');
        const searchOptions = document.querySelectorAll('.search-option');
        const minGradeInput = document.getElementById('minGrade');
        const maxGradeInput = document.getElementById('maxGrade');
        const workPage = document.getElementById('workPage');
        const workTitle = document.getElementById('workTitle');
        const workAuthor = document.getElementById('workAuthor');
        const workType = document.getElementById('workType');
        const workGradeLevel = document.getElementById('workGradeLevel');
        const workYear = document.getElementById('workYear');
        const workGrade = document.getElementById('workGrade');
        const workSupervisor = document.getElementById('workSupervisor');
        const workContent = document.getElementById('workContent');
        const workDownload = document.getElementById('workDownload');
        const backToSearch = document.getElementById('backToSearch');
        const workPreview = document.getElementById('workPreview');
        const workFrame = document.getElementById('workFrame');
        const viewToggle = document.getElementById('viewToggle');

        let currentType = 'all';
        let searchTimeout = null;

        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const workId = urlParams.get('workId');
            if (workId) showWorkPage(parseInt(workId));
            setupEventListeners();
        });

        function setupEventListeners() {
            searchInput.addEventListener('input', function () {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(performSearch, 300);
            });

            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') performSearch();
            });

            backToSearch.addEventListener('click', function (e) {
                e.preventDefault();
                workPage.style.display = 'none';
                searchResults.style.display = 'block';
            });

            viewToggle.addEventListener('click', togglePreview);

            searchOptions.forEach(option => {
                option.addEventListener('click', function () {
                    searchOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    currentType = this.dataset.type;
                    performSearch();
                });
            });

            minGradeInput.addEventListener('input', performSearch);
            maxGradeInput.addEventListener('input', performSearch);
        }

        function performSearch() {
            const query = searchInput.value.toLowerCase().trim();
            const minGrade = parseInt(minGradeInput.value) || 0;
            const maxGrade = parseInt(maxGradeInput.value) || 100;

            let results = worksDatabase.filter(work => {
                const matchesQuery = query === '' ||
                    work.title.toLowerCase().includes(query) ||
                    work.author.toLowerCase().includes(query);

                const matchesType =
                    currentType === 'all' ||
                    (currentType === 'research' && work.type === 'research') ||
                    (currentType === 'practical' && work.type === 'practical') ||
                    (currentType === '8grade' && work.gradeLevel === '8') ||
                    (currentType === '11grade' && work.gradeLevel === '11');

                const matchesGrade = work.grade >= minGrade && work.grade <= maxGrade;

                return matchesQuery && matchesType && matchesGrade;
            });

            displayResults(results);
        }

        function displayResults(results) {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.style.display = 'block';
            workPage.style.display = 'none';
            workPreview.style.display = 'none';
            viewToggle.textContent = '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–Ω–ª–∞–π–Ω';

            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="no-results">–†–∞–±–æ—Ç –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                return;
            }

            let html = '';
            results.forEach(work => {
                html += `
                    <div class="result-item" data-id="${work.id}">
                        <div class="result-title">${work.title}</div>
                        <div class="result-meta">${getTypeName(work.type)} | –ö–ª–∞—Å—Å: ${work.gradeLevel} | –ê–≤—Ç–æ—Ä: ${work.author} | –ì–æ–¥: ${work.year} | –ë–∞–ª–ª—ã: ${work.grade}/100 | –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å: ${work.supervisor}</div>
                        <div class="result-snippet">${getSnippet(work.content)}</div>
                    </div>
                `;
            });

            resultsContainer.innerHTML = html;

            document.querySelectorAll('.result-item').forEach(item => {
                item.addEventListener('click', function () {
                    const workId = parseInt(this.dataset.id);
                    showWorkPage(workId);
                });
            });
        }

        function showWorkPage(workId) {
            const work = worksDatabase.find(w => w.id === workId);
            if (!work) return;

            workTitle.textContent = work.title;
            workAuthor.textContent = work.author;
            workType.textContent = getTypeName(work.type);
            workGradeLevel.textContent = work.gradeLevel;
            workYear.textContent = work.year;
            workGrade.textContent = work.grade + '/100';
            workSupervisor.textContent = work.supervisor;
            workContent.textContent = work.content;

            workDownload.href = work.fileUrl;
            workDownload.innerHTML = 'üìÑ –û—Ç–∫—Ä—ã—Ç—å PDF';

            const fileId = extractFileId(work.fileUrl);
            if (fileId) {
                const previewUrl = `https://docs.google.com/viewer?embedded=true&url=https://drive.google.com/uc?id=${fileId}`;
                workFrame.src = previewUrl;
            }

            searchResults.style.display = 'none';
            workPage.style.display = 'block';
            workPreview.style.display = 'none';
            viewToggle.textContent = '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–Ω–ª–∞–π–Ω';
            window.scrollTo({ top: 0, behavior: 'smooth' });

            history.pushState(null, '', `?workId=${workId}`);
        }

        function togglePreview() {
            if (workPreview.style.display === 'none') {
                workPreview.style.display = 'block';
                this.textContent = '–°–∫—Ä—ã—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä';
            } else {
                workPreview.style.display = 'none';
                this.textContent = '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–Ω–ª–∞–π–Ω';
            }
        }

        function extractFileId(url) {
            if (!url) return null;
            const fileMatch = url.match(/\/file\/d\/([^\/]+)/);
            if (fileMatch) return fileMatch[1];
            const docMatch = url.match(/\/document\/d\/([^\/]+)/);
            if (docMatch) return docMatch[1];
            return null;
        }

        function getTypeName(type) {
            const types = {
                'research': '–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞',
                'practical': '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞'
            };
            return types[type] || '–†–∞–±–æ—Ç–∞';
        }

        function getSnippet(text, length = 150) {
            if (!text) return '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
            return text.length <= length ? text : text.substring(0, length) + '...';
        }

        // –ü—Ä–∏–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
        const worksDatabase = [
            {
                id: 1,
                title: '–ò–∑—É—á–µ–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π –¢–∞—Ä—Ç—É',
                author: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
                type: 'research',
                gradeLevel: '8',
                year: 2024,
                grade: 92,
                supervisor: '–ü–µ—Ç—Ä–æ–≤–∞ –ù.–í.',
                content: '–†–∞–±–æ—Ç–∞ –ø–æ—Å–≤—è—â–µ–Ω–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—é —Ñ–ª–æ—Ä—ã –ø–∞—Ä–∫–∞ –¢–∞–º–º–µ–∫–∞.',
                fileUrl: 'files/plants_tartu.pdf'
            }
        ];
    </script>
</body>
</html>
